### archi.py - скрипт для установки Arch linux.

Для лучшей читаемости используется простой процедур-ориентированный стиль.
Если вы хотите объектно-ориентированный посмотрите [Archinstall](https://wiki.archlinux.org/title/Archinstall)

Содержание можно разделить на 5-ть блоков:

1. [Переменные для настройки скрипта.](#setup-vars)
2. [Системные конфигурационные файлы.](#config-files)
3. [Основные функции.](#func)
4. [Блок-локализации. (В начальной стадии разработки)](#locale)
5. [Графический интерфейс.](#gui)


<a id="setup-vars"></a>
#### Переменные для настройки скрипта.
Например: списки устанавливаемых пакетов.

Можно добавить любые пакеты из официальных репозиториев.

Добавление пакетов из AUR, настраивается индивидуально.

> **Примечание:** Для упрощения настройки, значения по умолчанию лучше хранить в виде переменных в этом разделе.

<a id="config-files"></a>
#### Системные конфигурационные файлы.
Конфигурационные файлы дополнительных программ, хранятся в этом разделе.
> **Примечание:** Использование одного файла для хранения всех данных имеет несколько преимуществ: Возможность использования переменных для подстановки, файлы не потеряются, изменение файла будет заметно(новая версия.)

<a id="func"></a>
#### Основные функции.
**install_arch()** - вызов этой функции начинает установку Arch linux.
В нём последовательно вызываются действия необходимые для установки.
В конец этой функции рекомендуется добавлять ваши дополнительные действия.

**prepare_disk()** - разметка и форматирование диска.

**basic_configure()** - базовая конфигурация системы, рекомендуемая в [официальном руководстве](https://wiki.archlinux.org/title/Installation_guide_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B)

**install_pamac()** - установка менеджера пакетов pamac из репозитория AUR.
clone_and_makepkg(), demote() две вспомогательные функции для install_pamac.

**run()** - выполняет команду в отдельном процессе, весь вывод отправляет в log-файл.
В качестве аргументов должен быть список, первый аргументом которого исполняемая программа, последующие - её аргумента.

Пример:
```
args = ["pacman", "-U", "--noconfirm", "--root", root_mount_path, "--dbpath", root_mount_path+"/var/lib/pacman"]

package = ["example.pkg.tar.zst"]

run(args + package)
```

**show()** - печатает строку в интерфейс установочного окна. В log-файл не записывает. Аргументом является переменная типа строка.
Пример:
```
show("Имя компьютера: "+ hostname +" -> /etc/hostname")
```
Результат - отобразит в установочном окне: "Имя компьютера: archi -> /etc/hostname"

**write()** - записывает в файл. Перезаписывает существующий файл, начинает писать с начала файла. Аргументами являются два параметра: 
первый: тип список строк - которые будут записаны, 
второй: тип строка - путь и имя файла в который писать.
После записи выводит новое содержимое файла в лог файл и интерфейс установочного окна.

Пример:
```
write([hostname],root_mount_path + "/etc/hostname")
```

Результатом будет создан файл /mnt/etc/hostname c содержанием archi.(Подразумевается что переменные имеют значения: hostname = "archi" root_mount_path = "/mnt")

**write_end()** - синтаксис и использование аналогично функции write. Отличается от write тем что если файл существует, не пересоздаёт его - а дописывает в конец файла.

**run_install()** - функция обёртка для вызова install_arch из графического интерфейса.

Также есть другие вспомогательные функции, содержат краткие комментарии.

<a id="locale"></a>
#### Блок-локализации. (В начальной стадии разработки)
Возможно будет доделан.

<a id="gui"></a>
#### Графический интерфейс.
Графический интерфейс сделан с помощью стандартной библиотеки [tkinter](https://python-scripts.com/tkinter). В следующей версии планируется пересоздание интерфейса. Вначале блока расположены функции необходимые для функционирования графического интрефейса на базе tkinter.

Последние пять строк блока содержат важные строки.

Например обновляемый вывод установочного лог файла в интерфейс в процессе установки:
```
pop = Popen(["tail", "-f", log_install], stdout=PIPE, encoding='utf-8')
thrd_txt = Thread(target=read_flog, daemon=True)
thrd_txt.start()
```

Файл [archi.py](https://github.com/ksandronline/archi/blob/main/airootfs/skel/Desktop/archi.py) в репозитории.